openapi: 3.0.3

info:
  title: Walkie REST API
  description: |
    Official REST API documentation for Walkie Backend.
    
    
    **Current Version:** 2.2.2 (Multiple Conversations per Project + Naming Aliases)
  version: 2.2.2

servers:
  - url: https://ftafbdjzritdvsibpqtp.supabase.co
    description: Production

tags:
  - name: Auth
    description: Authentication & user identity (Supabase)
  - name: Projects
    description: Project management & membership (Backend "Projects" = Frontend "Conversations/Workspaces")
  - name: Project Members
    description: Add/remove/update project members
  - name: Conversations
    description: Conversations & memberships (Backend "Conversations" = Frontend "Projects/Channels")
  - name: Messages
    description: Messages, reactions, edits & mentions
  - name: Storage
    description: File upload & media management (Supabase Storage)
  - name: TODO Lists
    description: TODO list management
  - name: TODO Items
    description: TODO item management
  - name: Follow-ups
    description: Message follow-up tracking
  - name: Aliases v2
    description: |
      Frontend-friendly naming aliases (v2.2.2).
      
      **Naming Map:**
      - Frontend "Conversation" (Workspace) = Backend `project`
      - Frontend "Project" (Channel/Thread) = Backend `conversation`
  - name: Direct Access
    description: Direct table access (RLS-protected)

# ==========================
# SECURITY
# ==========================
components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: apikey
      description: Supabase anon key (public)

    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Supabase JWT token (from /auth/v1/token)

  # ==========================
  # REUSABLE SCHEMAS
  # ==========================
  schemas:
    UUID:
      type: string
      format: uuid
      example: "550e8400-e29b-41d4-a716-446655440000"

    Timestamp:
      type: string
      format: date-time
      example: "2026-02-02T14:30:00Z"

    Date:
      type: string
      format: date
      example: "2026-02-10"

    Error:
      type: object
      properties:
        message:
          type: string
        code:
          type: string
        hint:
          type: string

# ==========================
# PATHS
# ==========================
paths:

  # ======================================================
  # AUTH ‚Äî EMAIL / PASSWORD
  # ======================================================
  /auth/v1/token:
    post:
      tags: [Auth]
      summary: Login or Sign Up with email and password
      description: |
        Supabase Auth endpoint.
        
        - `grant_type=password` ‚Üí Login
        - `grant_type=signup` ‚Üí Create account (not standard, use /signup)
      security:
        - ApiKeyAuth: []
      parameters:
        - in: query
          name: grant_type
          required: true
          schema:
            type: string
            enum: [password]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                  example: alice@walker.dev
                password:
                  type: string
                  format: password
                  example: strongpassword123
      responses:
        '200':
          description: Authenticated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  refresh_token:
                    type: string
                  expires_in:
                    type: integer
                  token_type:
                    type: string
                    example: bearer
                  user:
                    type: object
        '400':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/v1/signup:
    post:
      tags: [Auth]
      summary: Sign up new user
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
                  minLength: 8
      responses:
        '200':
          description: User created
        '400':
          description: Invalid input

  # ======================================================
  # AUTH ‚Äî OAUTH (GOOGLE / APPLE)
  # ======================================================
  /auth/v1/authorize:
    get:
      tags: [Auth]
      summary: OAuth login (Google / Apple)
      description: |
        Redirect-based OAuth flow.
        
        Supported providers:
        - Google Sign In
        - Apple Sign In
      parameters:
        - in: query
          name: provider
          required: true
          schema:
            type: string
            enum: [google, apple]
        - in: query
          name: redirect_to
          required: false
          schema:
            type: string
            example: https://app.walker.dev/auth/callback
      responses:
        '302':
          description: Redirect to OAuth provider

  # ======================================================
  # PROJECTS
  # ======================================================
  /rest/v1/rpc/rpc__project_create:
    post:
      tags: [Projects]
      summary: Create project
      description: |
        Creates a new project. Authenticated user becomes owner.
        
        **Frontend mapping:** This is a "Conversation" (Workspace) in the frontend.
        
        **Permissions:** Any authenticated user
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_name, p_description]
              properties:
                p_name:
                  type: string
                  example: "Q1 2026 Launch"
                p_description:
                  type: string
                  example: "Planning for Q1 product launch"
      responses:
        '200':
          description: Project created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UUID'

  /rest/v1/rpc/rpc__project_list_for_user:
    post:
      tags: [Projects]
      summary: List projects for authenticated user
      description: |
        Returns all projects where user is a member.
        
        **Frontend mapping:** Returns "Conversations" (Workspaces) in the frontend.
        
        **Permissions:** Authenticated user
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: Projects list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    project_id:
                      $ref: '#/components/schemas/UUID'
                    name:
                      type: string
                    description:
                      type: string
                    archived:
                      type: boolean
                    role:
                      type: string
                      enum: [owner, admin, member]
                    unread_messages_count:
                      type: integer
                    last_activity_at:
                      $ref: '#/components/schemas/Timestamp'

  /rest/v1/rpc/rpc__project_archive:
    post:
      tags: [Projects]
      summary: Archive or unarchive project
      description: |
        Sets the archived flag on a project.
        
        **Permissions:** Project owner or admin
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id, p_archived]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
                p_archived:
                  type: boolean
      responses:
        '200':
          description: Project updated

  # ======================================================
  # PROJECT MEMBERS
  # ======================================================
  /rest/v1/rpc/rpc__project_member_add:
    post:
      tags: [Project Members]
      summary: Add member to project
      description: |
        Adds a user to a project by email.
        
        **Permissions:** Project owner or admin
        
        **Roles:** owner, admin, member
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id, p_user_email]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
                p_user_email:
                  type: string
                  format: email
                  example: "bob@example.com"
                p_role:
                  type: string
                  enum: [owner, admin, member]
                  default: member
      responses:
        '200':
          description: Member added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  project_id:
                    $ref: '#/components/schemas/UUID'
                  user_id:
                    $ref: '#/components/schemas/UUID'
                  role:
                    type: string
                  joined_at:
                    $ref: '#/components/schemas/Timestamp'
        '400':
          description: User not found or already a member
        '403':
          description: Permission denied

  /rest/v1/rpc/rpc__project_member_remove:
    post:
      tags: [Project Members]
      summary: Remove member from project
      description: |
        Removes a user from a project.
        
        **Permissions:** 
        - Project owner (can remove anyone)
        - Any member (can remove themselves)
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id, p_user_id]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
                p_user_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Member removed
        '403':
          description: Permission denied
        '404':
          description: User not a project member

  /rest/v1/rpc/rpc__project_member_update_role:
    post:
      tags: [Project Members]
      summary: Update member role
      description: |
        Changes a project member's role.
        
        **Permissions:** Project owner only
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id, p_user_id, p_new_role]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
                p_user_id:
                  $ref: '#/components/schemas/UUID'
                p_new_role:
                  type: string
                  enum: [owner, admin, member]
      responses:
        '200':
          description: Role updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  project_id:
                    $ref: '#/components/schemas/UUID'
                  user_id:
                    $ref: '#/components/schemas/UUID'
                  role:
                    type: string

  /rest/v1/rpc/rpc__project_member_list:
    post:
      tags: [Project Members]
      summary: List project members
      description: |
        Returns all members of a project.
        
        **Permissions:** Project member
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Members list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    user_id:
                      $ref: '#/components/schemas/UUID'
                    name:
                      type: string
                    email:
                      type: string
                    avatar:
                      type: string
                      nullable: true
                    role:
                      type: string
                    joined_at:
                      $ref: '#/components/schemas/Timestamp'

  /rest/v1/rpc/rpc__project_member_search:
    post:
      tags: [Project Members]
      summary: Search project members
      description: |
        Searches members of a project by name or email.
        
        **Permissions:** Project member
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id, p_query]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
                p_query:
                  type: string
                  example: "alice"
      responses:
        '200':
          description: Matching members
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    user_id:
                      $ref: '#/components/schemas/UUID'
                    name:
                      type: string
                    email:
                      type: string
                    avatar:
                      type: string
                      nullable: true
                    role:
                      type: string

  # ======================================================
  # CONVERSATIONS
  # ======================================================
  /rest/v1/rpc/rpc__conversation_create:
    post:
      tags: [Conversations]
      summary: Create conversation
      description: |
        Creates a new conversation with complete bootstrap:
        - Conversation record
        - Creator as member
        - Creator as owner role
        - Initial read state
        
        **Permissions:** Project member
        
        **Note (v2.2.1):** Multiple conversations per project are now supported.
        The previous restriction of one conversation per project has been removed.
        
        **Frontend mapping:** This is a "Project" (Channel/Thread) in the frontend.
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
                p_title:
                  type: string
                  example: "General Discussion"
                  nullable: true
                p_type:
                  type: string
                  enum: [project, direct]
                  default: project
            examples:
              project_conversation:
                summary: Project conversation
                value:
                  p_project_id: "550e8400-e29b-41d4-a716-446655440000"
                  p_title: "General Discussion"
                  p_type: "project"
              direct_conversation:
                summary: Direct conversation
                value:
                  p_project_id: "550e8400-e29b-41d4-a716-446655440000"
                  p_title: "Alice & Bob"
                  p_type: "direct"
      responses:
        '200':
          description: Conversation created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/UUID'
                  project_id:
                    $ref: '#/components/schemas/UUID'
                  title:
                    type: string
                  type:
                    type: string
                  created_by:
                    $ref: '#/components/schemas/UUID'
                  created_at:
                    $ref: '#/components/schemas/Timestamp'
                  last_message_at:
                    $ref: '#/components/schemas/Timestamp'
                    nullable: true
                  member_count:
                    type: integer
                  user_role:
                    type: string
        '403':
          description: Not a project member

  /rest/v1/rpc/rpc__conversation_list_for_user:
    post:
      tags: [Conversations]
      summary: List conversations for user
      description: |
        Returns all conversations where user is a member.
        Includes unread count per conversation.
        
        **NEW in v2.2:** Returns `marked_unread` flag to differentiate:
        - `marked_unread: false` - Naturally unread (new messages) ‚Üí Normal badge
        - `marked_unread: true` - Manually marked unread ‚Üí Special badge/indicator
        
        **Permissions:** Authenticated user
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: Conversations list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    conversation_id:
                      $ref: '#/components/schemas/UUID'
                    title:
                      type: string
                    type:
                      type: string
                    last_message_at:
                      $ref: '#/components/schemas/Timestamp'
                    unread_count:
                      type: integer
                      description: Number of unread messages
                    marked_unread:
                      type: boolean
                      description: |
                        True if user manually marked as unread.
                        False if naturally unread or read.
                        Use this to show different UI indicators.
                      example: false

  /rest/v1/rpc/rpc__conversation_mark_read:
    post:
      tags: [Conversations]
      summary: Mark conversation as read
      description: |
        Updates last read message for authenticated user.
        
        **Permissions:** Conversation member
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id, p_message_id]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                p_message_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Read state updated

  /rest/v1/rpc/rpc__conversation_mark_unread:
    post:
      tags: [Conversations]
      summary: Mark conversation as unread
      description: |
        Manually marks a conversation as unread for the authenticated user.
        Sets the `marked_unread` flag to differentiate from naturally unread conversations.
        
        **What it does:**
        - Clears `last_read_message_id` (makes conversation unread)
        - Sets `marked_unread = TRUE` (flags as manually marked)
        - Frontend can show special UI indicator (e.g., orange badge, pin icon)
        
        **Permissions:** Conversation member
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                  description: ID of the conversation to mark as unread
      responses:
        '204':
          description: Conversation marked as unread
        '403':
          description: Not a member of conversation
        '404':
          description: Conversation not found

  /rest/v1/rpc/rpc__conversation_member_add:
    post:
      tags: [Conversations]
      summary: Add member to conversation
      description: |
        Adds a user to a conversation.
        Creates: conversation_member, conversation_role (member), conversation_read.
        
        **Permissions:** Conversation owner or admin
        
        **Note:** User must be a project member first
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id, p_user_id]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                p_user_id:
                  $ref: '#/components/schemas/UUID'
                  description: Must be a project member
      responses:
        '200':
          description: Member added
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversation_id:
                    $ref: '#/components/schemas/UUID'
                  user_id:
                    $ref: '#/components/schemas/UUID'
                  role:
                    type: string
                    example: member
        '400':
          description: User not a project member or already in conversation
        '403':
          description: Permission denied

  /rest/v1/rpc/rpc__conversation_member_remove:
    post:
      tags: [Conversations]
      summary: Remove member from conversation
      description: |
        Removes a user from a conversation.
        Deletes: conversation_reads, conversation_roles, conversation_members.
        
        **Permissions:** 
        - Conversation owner (can remove anyone)
        - Self-remove (any member can leave)
        
        **Protection:** Cannot remove owner (unless self-remove)
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id, p_user_id]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                p_user_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Member removed
        '403':
          description: Permission denied
        '404':
          description: User not a conversation member

  # ======================================================
  # MESSAGES
  # ======================================================
  /rest/v1/rpc/rpc__message_send:
    post:
      tags: [Messages]
      summary: Send message
      description: |
        Creates a new message in a conversation.
        Sender automatically set from auth.uid().
        
        **Message Types:**
        - `text` - Regular text message
        - `file` - Media/file message (image, video, document, audio)
        - `system` - System notification
        
        **For media messages:**
        1. Upload file to Supabase Storage (`media` bucket) using `/storage/v1/object/media/{filePath}`
        2. Get public URL from upload response
        3. Send message with `message_type: "file"` and JSON metadata in `content`
        
        **Media message content format (JSON string):**
        
        {
          "url": "https://...supabase.co/storage/v1/object/public/media/user-id/file.jpg",
          "path": "user-id/timestamp.jpg",
          "name": "original-filename.jpg",
          "size": 245678,
          "type": "image/jpeg"
        }
        
        **Permissions:** Conversation member with write access
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id, p_content]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                p_content:
                  type: string
                  description: |
                    - For `text` messages: Plain text content
                    - For `file` messages: JSON string with file metadata (url, path, name, size, type)
                    - For `system` messages: System notification text
                  example: "Hello team!"
                p_message_type:
                  type: string
                  enum: [text, system, file]
                  default: text
            examples:
              text_message:
                summary: Text message
                value:
                  p_conversation_id: "550e8400-e29b-41d4-a716-446655440000"
                  p_content: "Hello team!"
                  p_message_type: "text"
              image_message:
                summary: Image message
                value:
                  p_conversation_id: "550e8400-e29b-41d4-a716-446655440000"
                  p_content: >
                    {"url":"https://ftafbdjzritdvsibpqtp.supabase.co/storage/v1/object/public/media/550e8400-e29b-41d4-a716-446655440000/1707123456789.jpg","path":"550e8400-e29b-41d4-a716-446655440000/1707123456789.jpg","name":"screenshot.jpg","size":245678,"type":"image/jpeg"}
                  p_message_type: "file"
              video_message:
                summary: Video message
                value:
                  p_conversation_id: "550e8400-e29b-41d4-a716-446655440000"
                  p_content: >
                    {"url":"https://ftafbdjzritdvsibpqtp.supabase.co/storage/v1/object/public/media/550e8400-e29b-41d4-a716-446655440000/1707123456790.mp4","path":"550e8400-e29b-41d4-a716-446655440000/1707123456790.mp4","name":"demo-video.mp4","size":5242880,"type":"video/mp4","duration":45}
                  p_message_type: "file"
              document_message:
                summary: Document message (PDF)
                value:
                  p_conversation_id: "550e8400-e29b-41d4-a716-446655440000"
                  p_content: >
                    {"url":"https://ftafbdjzritdvsibpqtp.supabase.co/storage/v1/object/public/media/550e8400-e29b-41d4-a716-446655440000/1707123456791.pdf","path":"550e8400-e29b-41d4-a716-446655440000/1707123456791.pdf","name":"proposal.pdf","size":1048576,"type":"application/pdf"}
                  p_message_type: "file"
              audio_message:
                summary: Audio message
                value:
                  p_conversation_id: "550e8400-e29b-41d4-a716-446655440000"
                  p_content: >
                    {"url":"https://ftafbdjzritdvsibpqtp.supabase.co/storage/v1/object/public/media/550e8400-e29b-41d4-a716-446655440000/1707123456792.mp3","path":"550e8400-e29b-41d4-a716-446655440000/1707123456792.mp3","name":"voice-note.mp3","size":524288,"type":"audio/mpeg","duration":30}
                  p_message_type: "file"
      responses:
        '200':
          description: Message created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UUID'
        '403':
          description: Not a conversation member or no write access

  /rest/v1/rpc/rpc__message_edit:
    post:
      tags: [Messages]
      summary: Edit message
      description: |
        Edits message content and logs edit history.
        
        **Permissions:** Message sender only
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_message_id, p_new_content]
              properties:
                p_message_id:
                  $ref: '#/components/schemas/UUID'
                p_new_content:
                  type: string
                  example: "Updated message content"
      responses:
        '200':
          description: Message updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/UUID'
                  conversation_id:
                    $ref: '#/components/schemas/UUID'
                  sender_id:
                    $ref: '#/components/schemas/UUID'
                  content:
                    type: string
                  message_type:
                    type: string
                  edited:
                    type: boolean
                  created_at:
                    $ref: '#/components/schemas/Timestamp'
                  updated_at:
                    $ref: '#/components/schemas/Timestamp'
        '403':
          description: Only sender can edit

  /rest/v1/rpc/rpc__message_delete:
    post:
      tags: [Messages]
      summary: Delete message (soft delete)
      description: |
        Soft deletes a message.
        
        **Permissions:** Message sender OR conversation admin/owner
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_message_id]
              properties:
                p_message_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Message deleted
        '403':
          description: Permission denied

  /rest/v1/rpc/rpc__message_react:
    post:
      tags: [Messages]
      summary: Add reaction to message
      description: |
        Adds emoji reaction to a message.
        
        **Permissions:** Conversation member with write access
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_message_id, p_reaction]
              properties:
                p_message_id:
                  $ref: '#/components/schemas/UUID'
                p_reaction:
                  type: string
                  example: "üëç"
      responses:
        '204':
          description: Reaction added

  /rest/v1/rpc/rpc__message_unreact:
    post:
      tags: [Messages]
      summary: Remove reaction from message
      description: |
        Removes user's reaction from a message.
        
        **Permissions:** User who reacted
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_message_id, p_reaction]
              properties:
                p_message_id:
                  $ref: '#/components/schemas/UUID'
                p_reaction:
                  type: string
                  example: "üëç"
      responses:
        '204':
          description: Reaction removed

  # ======================================================
  # STORAGE
  # ======================================================
  /storage/v1/object/media/{filePath}:
    post:
      tags: [Storage]
      summary: Upload file to media bucket
      description: |
        Uploads a file to Supabase Storage media bucket.
        
        **Bucket:** `media`
        
        **File path structure:** `{user_id}/{timestamp}.{extension}`
        
        **Complete workflow to send media message:**
        1. **Upload file** ‚Üí Use this endpoint (POST)
        2. **Get public URL** ‚Üí From response or use `/storage/v1/object/public/media/{filePath}`
        3. **Send message** ‚Üí Call `rpc__message_send` with `message_type: "file"` and JSON metadata in `content`
        
        **Allowed file types:**
        - **Images:** jpg, jpeg, png, gif, webp, svg
        - **Videos:** mp4, mov, avi, webm
        - **Documents:** pdf, doc, docx, txt, csv, xlsx
        - **Audio:** mp3, wav, m4a, ogg
        
        **Max file size:** 50MB
        
        **RLS Policies:** User must be authenticated and can only upload to their own folder (`{user_id}/`)
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      parameters:
        - in: path
          name: filePath
          required: true
          schema:
            type: string
          example: "550e8400-e29b-41d4-a716-446655440000/1707123456789.jpg"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
          image/jpeg:
            schema:
              type: string
              format: binary
          image/png:
            schema:
              type: string
              format: binary
          video/mp4:
            schema:
              type: string
              format: binary
          application/pdf:
            schema:
              type: string
              format: binary
          audio/mpeg:
            schema:
              type: string
              format: binary
      responses:
        '200':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  Key:
                    type: string
                    example: "media/550e8400-e29b-41d4-a716-446655440000/1707123456789.jpg"
        '400':
          description: Invalid file, file too large, or invalid path
        '401':
          description: Unauthorized
        '403':
          description: Permission denied

    get:
      tags: [Storage]
      summary: Download/view file
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      parameters:
        - in: path
          name: filePath
          required: true
          schema:
            type: string
      responses:
        '200':
          description: File content
        '404':
          description: File not found

    delete:
      tags: [Storage]
      summary: Delete file
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      parameters:
        - in: path
          name: filePath
          required: true
          schema:
            type: string
      responses:
        '204':
          description: File deleted successfully
        '403':
          description: Permission denied
        '404':
          description: File not found

  /storage/v1/object/public/media/{filePath}:
    get:
      tags: [Storage]
      summary: Get public URL for file
      parameters:
        - in: path
          name: filePath
          required: true
          schema:
            type: string
      responses:
        '200':
          description: File content (redirects to CDN)
        '404':
          description: File not found

  # ======================================================
  # TODO LISTS
  # ======================================================
  /rest/v1/rpc/rpc__todo_list_create:
    post:
      tags: [TODO Lists]
      summary: Create TODO list
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
                p_title:
                  type: string
                  default: "Untitled List"
                  example: "Sprint Tasks"
      responses:
        '200':
          description: TODO list created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/UUID'
                  project_id:
                    $ref: '#/components/schemas/UUID'
                  title:
                    type: string
                  archived:
                    type: boolean
                  created_by:
                    $ref: '#/components/schemas/UUID'
                  created_at:
                    $ref: '#/components/schemas/Timestamp'

  /rest/v1/rpc/rpc__todo_list_update:
    post:
      tags: [TODO Lists]
      summary: Update TODO list
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_list_id]
              properties:
                p_list_id:
                  $ref: '#/components/schemas/UUID'
                p_title:
                  type: string
                  nullable: true
                p_archived:
                  type: boolean
                  nullable: true
      responses:
        '200':
          description: TODO list updated

  /rest/v1/rpc/rpc__todo_list_delete:
    post:
      tags: [TODO Lists]
      summary: Delete TODO list (soft delete)
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_list_id]
              properties:
                p_list_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: TODO list deleted

  # ======================================================
  # TODO ITEMS
  # ======================================================
  /rest/v1/rpc/rpc__todo_item_create:
    post:
      tags: [TODO Items]
      summary: Create TODO item
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_list_id, p_title]
              properties:
                p_list_id:
                  $ref: '#/components/schemas/UUID'
                p_title:
                  type: string
                  example: "Fix login bug"
                p_priority:
                  type: string
                  enum: [low, medium, high]
                  nullable: true
                p_due_date:
                  $ref: '#/components/schemas/Date'
                  nullable: true
                p_assigned_to:
                  $ref: '#/components/schemas/UUID'
                  nullable: true
      responses:
        '200':
          description: TODO item created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/UUID'
                  list_id:
                    $ref: '#/components/schemas/UUID'
                  title:
                    type: string
                  completed:
                    type: boolean
                  priority:
                    type: string
                  due_date:
                    $ref: '#/components/schemas/Date'
                  assigned_to:
                    $ref: '#/components/schemas/UUID'
                  completed_at:
                    $ref: '#/components/schemas/Timestamp'
                    nullable: true
                  created_by:
                    $ref: '#/components/schemas/UUID'
                  created_at:
                    $ref: '#/components/schemas/Timestamp'

  /rest/v1/rpc/rpc__todo_item_update:
    post:
      tags: [TODO Items]
      summary: Update TODO item
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_item_id]
              properties:
                p_item_id:
                  $ref: '#/components/schemas/UUID'
                p_title:
                  type: string
                  nullable: true
                p_priority:
                  type: string
                  enum: [low, medium, high, ""]
                  nullable: true
                p_due_date:
                  $ref: '#/components/schemas/Date'
                  nullable: true
                p_assigned_to:
                  $ref: '#/components/schemas/UUID'
                  nullable: true
      responses:
        '200':
          description: TODO item updated

  /rest/v1/rpc/rpc__todo_item_toggle_complete:
    post:
      tags: [TODO Items]
      summary: Toggle TODO item completion
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_item_id]
              properties:
                p_item_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: TODO item toggled
          content:
            application/json:
              schema:
                type: object
                properties:
                  completed:
                    type: boolean
                  completed_at:
                    $ref: '#/components/schemas/Timestamp'
                    nullable: true

  /rest/v1/rpc/rpc__todo_item_delete:
    post:
      tags: [TODO Items]
      summary: Delete TODO item (soft delete)
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_item_id]
              properties:
                p_item_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: TODO item deleted

  # ======================================================
  # FOLLOW-UPS
  # ======================================================
  /rest/v1/rpc/rpc__follow_up_create:
    post:
      tags: [Follow-ups]
      summary: Create follow-up from message
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_message_id]
              properties:
                p_message_id:
                  $ref: '#/components/schemas/UUID'
                p_note:
                  type: string
                  nullable: true
                  example: "Need to follow up on this decision"
                p_due_at:
                  $ref: '#/components/schemas/Timestamp'
                  nullable: true
      responses:
        '200':
          description: Follow-up created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/UUID'
                  project_id:
                    $ref: '#/components/schemas/UUID'
                  message_id:
                    $ref: '#/components/schemas/UUID'
                  owner_id:
                    $ref: '#/components/schemas/UUID'
                  status:
                    type: string
                  note:
                    type: string
                  due_at:
                    $ref: '#/components/schemas/Timestamp'
                  created_at:
                    $ref: '#/components/schemas/Timestamp'

  /rest/v1/rpc/rpc__follow_up_update:
    post:
      tags: [Follow-ups]
      summary: Update follow-up
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_follow_up_id]
              properties:
                p_follow_up_id:
                  $ref: '#/components/schemas/UUID'
                p_status:
                  type: string
                  enum: [pending, in_progress, completed, cancelled]
                  nullable: true
                p_note:
                  type: string
                  nullable: true
                p_due_at:
                  $ref: '#/components/schemas/Timestamp'
                  nullable: true
      responses:
        '200':
          description: Follow-up updated

  /rest/v1/rpc/rpc__follow_up_delete:
    post:
      tags: [Follow-ups]
      summary: Delete follow-up (soft delete)
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_follow_up_id]
              properties:
                p_follow_up_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Follow-up deleted

  # ======================================================
  # ALIASES V2 ‚Äî CONVERSATIONS (Frontend) = PROJECTS (Backend)
  # ======================================================
  /rest/v1/rpc/rpc__conversation_create_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Create conversation/workspace (Frontend)"
      description: |
        **Frontend alias** for `rpc__project_create`.
        
        In the frontend, a "Conversation" is a Workspace/top-level container.
        This maps to a backend `project`.
        
        **Delegates to:** `rpc__project_create(p_name, p_description)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_name, p_description]
              properties:
                p_name:
                  type: string
                  example: "My Workspace"
                p_description:
                  type: string
                  example: "Team workspace"
      responses:
        '200':
          description: Workspace created ‚Äî returns UUID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UUID'

  /rest/v1/rpc/rpc__conversation_list_for_user_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] List conversations/workspaces for user (Frontend)"
      description: |
        **Frontend alias** for `rpc__project_list_for_user`.
        
        Returns workspaces where the user is a member.
        
        **Delegates to:** `rpc__project_list_for_user()`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: Workspaces list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    conversation_id:
                      $ref: '#/components/schemas/UUID'
                    name:
                      type: string
                    description:
                      type: string
                    archived:
                      type: boolean
                    role:
                      type: string
                      enum: [owner, admin, member]
                    unread_messages_count:
                      type: integer
                    last_activity_at:
                      $ref: '#/components/schemas/Timestamp'

  /rest/v1/rpc/rpc__conversation_archive_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Archive/unarchive conversation/workspace (Frontend)"
      description: |
        **Frontend alias** for `rpc__project_archive`.
        
        **Delegates to:** `rpc__project_archive(p_conversation_id, p_archived)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id, p_archived]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                p_archived:
                  type: boolean
      responses:
        '200':
          description: Updated

  /rest/v1/rpc/rpc__conversation_member_add_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Add member to conversation/workspace (Frontend)"
      description: |
        **Frontend alias** for `rpc__project_member_add`.
        
        **Delegates to:** `rpc__project_member_add(p_conversation_id, p_user_email, p_role)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id, p_user_email]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                p_user_email:
                  type: string
                  format: email
                p_role:
                  type: string
                  enum: [owner, admin, member]
                  default: member
      responses:
        '200':
          description: Member added
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversation_id:
                    $ref: '#/components/schemas/UUID'
                  user_id:
                    $ref: '#/components/schemas/UUID'
                  role:
                    type: string
                  joined_at:
                    $ref: '#/components/schemas/Timestamp'

  /rest/v1/rpc/rpc__conversation_member_remove_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Remove member from conversation/workspace (Frontend)"
      description: |
        **Frontend alias** for `rpc__project_member_remove`.
        
        **Delegates to:** `rpc__project_member_remove(p_conversation_id, p_user_id)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id, p_user_id]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                p_user_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Member removed

  /rest/v1/rpc/rpc__conversation_member_update_role_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Update member role in conversation/workspace (Frontend)"
      description: |
        **Frontend alias** for `rpc__project_member_update_role`.
        
        **Delegates to:** `rpc__project_member_update_role(p_conversation_id, p_user_id, p_new_role)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id, p_user_id, p_new_role]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                p_user_id:
                  $ref: '#/components/schemas/UUID'
                p_new_role:
                  type: string
                  enum: [owner, admin, member]
      responses:
        '200':
          description: Role updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  conversation_id:
                    $ref: '#/components/schemas/UUID'
                  user_id:
                    $ref: '#/components/schemas/UUID'
                  role:
                    type: string

  /rest/v1/rpc/rpc__conversation_member_list_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] List members of conversation/workspace (Frontend)"
      description: |
        **Frontend alias** for `rpc__project_member_list`.
        
        **Delegates to:** `rpc__project_member_list(p_conversation_id)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Members list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    user_id:
                      $ref: '#/components/schemas/UUID'
                    name:
                      type: string
                    email:
                      type: string
                    avatar:
                      type: string
                      nullable: true
                    role:
                      type: string
                    joined_at:
                      $ref: '#/components/schemas/Timestamp'

  /rest/v1/rpc/rpc__conversation_member_search_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Search members of conversation/workspace (Frontend)"
      description: |
        **Frontend alias** for `rpc__project_member_search`.
        
        **Delegates to:** `rpc__project_member_search(p_conversation_id, p_query)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id, p_query]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                p_query:
                  type: string
                  example: "alice"
      responses:
        '200':
          description: Matching members
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    user_id:
                      $ref: '#/components/schemas/UUID'
                    name:
                      type: string
                    email:
                      type: string
                    avatar:
                      type: string
                      nullable: true
                    role:
                      type: string

  # ======================================================
  # ALIASES V2 ‚Äî PROJECTS (Frontend) = CONVERSATIONS (Backend)
  # ======================================================
  /rest/v1/rpc/rpc__project_create_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Create project/channel (Frontend)"
      description: |
        **Frontend alias** for `rpc__conversation_create`.
        
        In the frontend, a "Project" is a Channel/Thread inside a workspace.
        This maps to a backend `conversation`.
        
        **Delegates to:** `rpc__conversation_create(p_conversation_id, p_title, p_type)`
        
        **Note:** Multiple projects per workspace are supported (v2.2.1).
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_conversation_id]
              properties:
                p_conversation_id:
                  $ref: '#/components/schemas/UUID'
                  description: ID of the parent workspace (backend project)
                p_title:
                  type: string
                  example: "General"
                  nullable: true
                p_type:
                  type: string
                  enum: [project, direct]
                  default: project
      responses:
        '200':
          description: Project/channel created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/UUID'
                  conversation_id:
                    $ref: '#/components/schemas/UUID'
                    description: ID of the parent workspace
                  title:
                    type: string
                  type:
                    type: string
                  created_by:
                    $ref: '#/components/schemas/UUID'
                  created_at:
                    $ref: '#/components/schemas/Timestamp'
                  last_message_at:
                    $ref: '#/components/schemas/Timestamp'
                    nullable: true
                  member_count:
                    type: integer
                  user_role:
                    type: string
        '403':
          description: Not a workspace member

  /rest/v1/rpc/rpc__project_list_for_user_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] List projects/channels for user (Frontend)"
      description: |
        **Frontend alias** for `rpc__conversation_list_for_user`.
        
        Returns projects (channels/threads) where user is a member.
        
        **Delegates to:** `rpc__conversation_list_for_user()`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: Projects/channels list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    project_id:
                      $ref: '#/components/schemas/UUID'
                    title:
                      type: string
                    type:
                      type: string
                    last_message_at:
                      $ref: '#/components/schemas/Timestamp'
                    unread_count:
                      type: integer
                    marked_unread:
                      type: boolean

  /rest/v1/rpc/rpc__project_mark_read_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Mark project/channel as read (Frontend)"
      description: |
        **Frontend alias** for `rpc__conversation_mark_read`.
        
        **Delegates to:** `rpc__conversation_mark_read(p_project_id, p_message_id)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id, p_message_id]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
                p_message_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Read state updated

  /rest/v1/rpc/rpc__project_mark_unread_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Mark project/channel as unread (Frontend)"
      description: |
        **Frontend alias** for `rpc__conversation_mark_unread`.
        
        **Delegates to:** `rpc__conversation_mark_unread(p_project_id)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Marked as unread

  /rest/v1/rpc/rpc__project_member_add_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Add member to project/channel (Frontend)"
      description: |
        **Frontend alias** for `rpc__conversation_member_add`.
        
        **Delegates to:** `rpc__conversation_member_add(p_project_id, p_user_id)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id, p_user_id]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
                p_user_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: Member added
          content:
            application/json:
              schema:
                type: object
                properties:
                  project_id:
                    $ref: '#/components/schemas/UUID'
                  user_id:
                    $ref: '#/components/schemas/UUID'
                  role:
                    type: string

  /rest/v1/rpc/rpc__project_member_remove_v2:
    post:
      tags: [Aliases v2]
      summary: "[Alias] Remove member from project/channel (Frontend)"
      description: |
        **Frontend alias** for `rpc__conversation_member_remove`.
        
        **Delegates to:** `rpc__conversation_member_remove(p_project_id, p_user_id)`
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_project_id, p_user_id]
              properties:
                p_project_id:
                  $ref: '#/components/schemas/UUID'
                p_user_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Member removed

  # ======================================================
  # USERS
  # ======================================================
  /rest/v1/rpc/rpc__user_get_profile:
    post:
      tags: [Auth]
      summary: Get current user profile
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    $ref: '#/components/schemas/UUID'
                  name:
                    type: string
                  email:
                    type: string
                  phone:
                    type: string
                    nullable: true
                  avatar:
                    type: string
                    nullable: true
                  theme:
                    type: string
                    enum: [light, dark, system]
                    nullable: true
                  status:
                    type: string
                  created_at:
                    $ref: '#/components/schemas/Timestamp'
                  updated_at:
                    $ref: '#/components/schemas/Timestamp'

  /rest/v1/rpc/rpc__user_update_profile:
    post:
      tags: [Auth]
      summary: Update user profile
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                p_name:
                  type: string
                  nullable: true
                p_phone:
                  type: string
                  nullable: true
                p_avatar:
                  type: string
                  nullable: true
      responses:
        '200':
          description: Profile updated

  /rest/v1/rpc/rpc__user_update_theme:
    post:
      tags: [Auth]
      summary: Update user theme preference
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_theme]
              properties:
                p_theme:
                  type: string
                  enum: [light, dark, system]
                  example: "dark"
      responses:
        '200':
          description: Theme updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  theme:
                    type: string

  # ======================================================
  # NOTIFICATIONS
  # ======================================================
  /rest/v1/rpc/rpc__notification_list_for_user:
    post:
      tags: [Notifications]
      summary: List notifications for user
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: Notifications
          content:
            application/json:
              schema:
                type: object
                properties:
                  unread:
                    type: array
                    items:
                      type: object
                  all:
                    type: array
                    items:
                      type: object

  /rest/v1/rpc/rpc__notification_mark_read:
    post:
      tags: [Notifications]
      summary: Mark notification as read
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_notification_id]
              properties:
                p_notification_id:
                  $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: Notification marked as read
        '404':
          description: Not found

  /rest/v1/rpc/rpc__notification_mark_all_read:
    post:
      tags: [Notifications]
      summary: Mark all notifications as read
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      responses:
        '204':
          description: All notifications marked as read

  # ======================================================
  # DIRECT TABLE ACCESS (RLS-protected)
  # ======================================================
  /rest/v1/conversations:
    get:
      tags: [Direct Access]
      summary: Query conversations table
      description: |
        Direct access to conversations table.
        RLS enforces user can only see their conversations.
        
        **Note:** Prefer using RPC endpoints.
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      parameters:
        - in: query
          name: select
          schema:
            type: string
          example: "*"
        - in: query
          name: project_id
          schema:
            $ref: '#/components/schemas/UUID'
        - in: query
          name: deleted_at
          schema:
            type: string
          example: "is.null"
      responses:
        '200':
          description: Conversations list

  /rest/v1/messages:
    get:
      tags: [Direct Access]
      summary: Query messages table
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      parameters:
        - in: query
          name: select
          schema:
            type: string
          example: "*"
        - in: query
          name: conversation_id
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - in: query
          name: order
          schema:
            type: string
          example: "created_at.desc"
        - in: query
          name: limit
          schema:
            type: integer
          example: 50
      responses:
        '200':
          description: Messages list

  /rest/v1/todo_lists:
    get:
      tags: [Direct Access]
      summary: Query TODO lists table
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      parameters:
        - in: query
          name: select
          schema:
            type: string
          example: "*"
        - in: query
          name: project_id
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - in: query
          name: deleted_at
          schema:
            type: string
          example: "is.null"
      responses:
        '200':
          description: TODO lists

  /rest/v1/todo_items:
    get:
      tags: [Direct Access]
      summary: Query TODO items table
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      parameters:
        - in: query
          name: select
          schema:
            type: string
          example: "*"
        - in: query
          name: list_id
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
        - in: query
          name: completed
          schema:
            type: string
          example: "eq.false"
        - in: query
          name: order
          schema:
            type: string
          example: "priority.desc,created_at.asc"
      responses:
        '200':
          description: TODO items

  /rest/v1/follow_ups:
    get:
      tags: [Direct Access]
      summary: Query follow-ups table
      security:
        - ApiKeyAuth: []
        - BearerAuth: []
      parameters:
        - in: query
          name: select
          schema:
            type: string
          example: "*"
        - in: query
          name: project_id
          schema:
            $ref: '#/components/schemas/UUID'
        - in: query
          name: status
          schema:
            type: string
          example: "eq.pending"
      responses:
        '200':
          description: Follow-ups list
